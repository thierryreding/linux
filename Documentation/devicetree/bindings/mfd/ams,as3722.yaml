# SPDX-License-Identifier: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/mfd/ams,as3722.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: AMS AS3722 Power Management IC

maintainers:
  - Laxman Dewangan <ldewangan@nvidia.com>
  - Lee Jones <lee.jones@linaro.org>

properties:
  compatible:
    const: ams,as3722

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  # standard properties
  interrupt-controller:
    description: The AS3722 has an internal interrupt controller which takes the interrupt request
      from internal sub-blocks like RTC, regulators, GPIOs as well as external input.

  "#interrupt-cells":
    description: The first cell is the IRQ number. IRQ numbers for different interrupt source of
      AS3722 are defined at dt-bindings/mfd/as3722.h The second cell is the flags, encoded as the
      trigger masks from binding document interrupts.txt, using dt-bindings/irq.
    const: 2

  # from gpio.yaml
  gpio-controller: true
  "#gpio-cells": true

  # optional properties
  ams,enable-internal-int-pullup:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Boolean property, to enable internal pullup on interrupt pin. Omitting this will
      disable internal pullup on INT pin.

  ams,enable-internal-i2c-pullup:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Boolean property, to enable internal pullup on I2C SCL/SDA pins. Omitting this
      will disable internal pullup on I2C SCL/SDA lines.

  ams,enable-ac-ok-power-on:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Boolean property, to enable exit out of power off mode with AC_OK pin (pin
      enabled in power off mode).

  ams,system-power-controller:
    $ref: /schemas/types.yaml#/definitions/flag
    description: The AS3722 supports the system power off by turning off all its rails. The device
      node should contain this boolean property to enable this functionality.

  pinmux:
    type: object
    description: |
      Device has 8 GPIO pins which can be configured as GPIO as well as the special IO functions.

      Please refer to pinctrl-bindings.txt in this directory for details of the common pinctrl
      bindings used by client devices, including the meaning of the phrase "pin configuration
      node".

    patternProperties:
      "^gpio[0-7_]+$":
        description: |
          Child nodes of the pinmux node represent some desired configuration for a list of pins.
          This configuration can include the mux function to select on those pin(s), and various
          pin configuration parameters, such as pull-up, open drain.
        type: object
        properties:
          pins:
            $ref: /schemas/types.yaml#/definitions/string-array
            description: List of pins for this configuration group.
            items:
              enum: [ gpio0, gpio1, gpio2, gpio3, gpio4, gpio5, gpio6, gpio7 ]

          function:
            $ref: /schemas/types.yaml#/definitions/string
            description: Function configuration for this configuration group.
            enum: [ gpio, interrupt-out, gpio-in-interrupt, vsup-vbat-low-undebounce-out,
                    vsup-vbat-low-debounce-out, voltage-in-standby, oc-pg-sd0, oc-pg-sd6,
                    powergood-out, pwm-in, pwm-out, clk32k-out, watchdog-in, soft-reset-in ]

          bias-disable:
            $ref: /schemas/types.yaml#/definitions/flag

          bias-pull-up:
            $ref: /schemas/types.yaml#/definitions/flag

          bias-pull-down:
            $ref: /schemas/types.yaml#/definitions/flag

          bias-high-impedance:
            $ref: /schemas/types.yaml#/definitions/flag

          drive-open-drain:
            $ref: /schemas/types.yaml#/definitions/flag

        additionalProperties: false

        required:
          - pins

  regulators:
    type: object
    description: Device has multiple DCDC and LDOs. The node "regulators" is require if regulator
      functionality is needed.

    properties:
      vsup-sd2-supply:
        description: input supply for SD2

      vsup-sd3-supply:
        description: input supply for SD3

      vsup-sd4-supply:
        description: input supply for SD4

      vsup-sd5-supply:
        description: input supply for SD5

      vin-ldo0-supply:
        description: input supply for LDO0

      vin-ldo1-6-supply:
        description: input supply for LDO1 and LDO6

      vin-ldo2-5-7-supply:
        description: input supply for LDO2, LDO5 and LDO7

      vin-ldo3-4-supply:
        description: input supply for LDO3 and LDO4

      vin-ldo9-10-supply:
        description: input supply for LDO9 and LDO10

      vin-ldo11-supply:
        description: input supply for LDO11

    patternProperties:
      "^(sd[0-6]|ldo[0-7]|ldo9|ldo10|ldo11)$":
        type: object
        description: These sub-nodes must be named after one of the regulators found on the AS3277.
          Each sub-node should contain the constraints and initialization information for that
          regulator. See regulator.txt for a description of standard properties for these
          sub-nodes.

        properties:
          ams,ext-control:
            $ref: /schemas/types.yaml#/definitions/uint32
            description: External control of the rail. The option of this properties will tell
              which external input is controlling this rail. Valid values are 0, 1, 2 ad 3. If
              this property does not exist, the default value is 0. The external control pin
              macros are defined in dt-bindings/mfd/as3722.h.
            oneOf:
              - description: there is no external control of this rail
                const: 0
              - description: rail is controlled by ENABLE1 input pin
                const: 1
              - description: rail is controlled by ENABLE2 input pin
                const: 2
              - description: rail is controlled by ENABLE3 input pin
                const: 3

          ams,enable-tracking:
            $ref: /schemas/types.yaml#/definitions/flag
            description: Enable tracking with SD1, only supported by LDO3.

additionalProperties: false

required:
  - compatible
  - reg
  - interrupt-controller
  - "#interrupt-cells"

allOf:
  - $ref: /schemas/gpio/gpio.yaml

examples:
  - |
    #include <dt-bindings/mfd/as3722.h>

    i2c {
      #address-cells = <1>;
      #size-cells = <0>;

      pmic@48 {
        compatible = "ams,as3722";
        reg = <0x48>;

        ams,system-power-controller;

        interrupt-parent = <&intc>;
        interrupt-controller;
        #interrupt-cells = <2>;

        gpio-controller;
        #gpio-cells = <2>;

        pinctrl-names = "default";
        pinctrl-0 = <&as3722_default>;

        as3722_default: pinmux {
          gpio0 {
            pins = "gpio0";
            function = "gpio";
            bias-pull-down;
          };

          gpio1_2_4_7 {
            pins = "gpio1", "gpio2", "gpio4", "gpio7";
            function = "gpio";
            bias-pull-up;
          };

          gpio5 {
            pins = "gpio5";
            function = "clk32k-out";
          };
        };

        regulators {
          vsup-sd2-supply = <&vdd_5v0_sys>;

          sd0 {
            regulator-name = "vdd_cpu";
            regulator-min-microvolt = <700000>;
            regulator-max-microvolt = <1400000>;
            regulator-always-on;
            ams,ext-control = <2>;
          };

          sd1 {
            regulator-name = "vdd_core";
            regulator-min-microvolt = <700000>;
            regulator-max-microvolt = <1400000>;
            regulator-always-on;
            ams,ext-control = <1>;
          };

          sd2 {
            regulator-name = "vddio_ddr";
            regulator-min-microvolt = <1350000>;
            regulator-max-microvolt = <1350000>;
            regulator-always-on;
          };

          sd4 {
            regulator-name = "avdd-hdmi-pex";
            regulator-min-microvolt = <1050000>;
            regulator-max-microvolt = <1050000>;
            regulator-always-on;
          };

          sd5 {
            regulator-name = "vdd-1v8";
            regulator-min-microvolt = <1800000>;
            regulator-max-microvolt = <1800000>;
            regulator-always-on;
          };
        };
      };
    };
