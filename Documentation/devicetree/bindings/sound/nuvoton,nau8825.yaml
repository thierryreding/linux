# SPDX-License-Identifier: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/sound/nuvoton,nau8825.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Nuvoton NAU8825 audio codec

maintainers:
  - Anatol Pomozov <anatol.pomozov@gmail.com>
  - Mark Brown <broonie@kernel.org>

description: |
  This device supports I2C only.

properties:
  compatible:
    const: nuvoton,nau8825

  reg:
    # 0x1a for CSB = 0, 0x1b for CSB = 1
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks:
    items:
      - description: MCLK master clock

  clock-names:
    items:
      - const: mclk

  nuvoton,jkdet-enable:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Enable jack detection via JKDET pin.

  nuvoton,jkdet-pull-enable:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Enable JKDET pin pull. If set, pin pull is enabled, otherwise pin is in high
      impedance state.

  nuvoton,jkdet-pull-up:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Pull-up JKDET pin. If set then JKDET pin is pull up, otherwise pull down.

  nuvoton,jkdet-polarity:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: JKDET pin polarity
    oneOf:
      - description: active-high
        const: 0
      - description: active-low
        const: 1

  nuvoton,vref-impedance:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: VREF impedance selection
    oneOf:
      - description: open
        const: 0
      - description: 25 kOhm
        const: 1
      - description: 125 kOhm
        const: 2
      - description: 2.5 kOhm
        const: 3

  nuvoton,micbias-voltage:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Micbias voltage level
    oneOf:
      - description: VDDA
        const: 0
      - description: VDDA
        const: 1
      - description: VDDA * 1.1
        const: 2
      - description: VDDA * 1.2
        const: 3
      - description: VDDA * 1.3
        const: 4
      - description: VDDA * 1.4
        const: 5
      - description: VDDA * 1.53
        const: 6
      - description: VDDA * 1.53
        const: 7

  nuvoton,sar-threshold-num:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: number of buttons supported

  nuvoton,sar-threshold:
    $ref: /schemas/types.yaml#/definitions/uint32-array
    minItems: 1
    maxItems: 8
    description: |
      Impedance threshold for each button. Array that contains up to 8 buttons configuration. SAR
      value is calculated as

        SAR = 255 * MICBIAS / SAR_VOLTAGE * R / (2000 + R)

      where MICBIAS is configured by 'nuvoton,micbias-voltage', SAR_VOLTAGE is configured by
      'nuvoton,sar-voltage', R - button impedance.

      Refer datasheet section 10.2 for more information about threshold calculation.

  nuvoton,sar-hysteresis:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: button impedance measurement hysteresis

  nuvoton,sar-voltage:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: reference voltage for button impedance measurement
    oneOf:
      - description: VDDA
        const: 0
      - description: VDDA
        const: 1
      - description: VDDA * 1.1
        const: 2
      - description: VDDA * 1.2
        const: 3
      - description: VDDA * 1.3
        const: 4
      - description: VDDA * 1.4
        const: 5
      - description: VDDA * 1.53
        const: 6
      - description: VDDA * 1.53
        const: 7

  nuvoton,sar-compare-time:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: SAR compare time
    oneOf:
      - description: 500 ns
        const: 0
      - description: 1 us
        const: 1
      - description: 2 us
        const: 2
      - description: 4 us
        const: 3

  nuvoton,sar-sampling-time:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: SAR sampling time
    oneOf:
      - description: 2 us
        const: 0
      - description: 4 us
        const: 1
      - description: 8 us
        const: 2
      - description: 16 us
        const: 3

  nuvoton,short-key-debounce:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: button short key press debounce time
    oneOf:
      - description: 30 ms
        const: 0
      - description: 50 ms
        const: 1
      - description: 100 ms
        const: 2
      - description: 30 ms
        const: 3

  nuvoton,jack-insert-debounce:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: number from 0 to 7 that sets debounce time to 2^(n+2) ms
    minimum: 0
    maximum: 7

  nuvoton,jack-eject-debounce:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: number from 0 to 7 that sets debounce time to 2^(n+2) ms
    minimum: 0
    maximum: 7

  nuvoton,crosstalk-enable:
    description: If set, enables crosstalk function.
    $ref: /schemas/types.yaml#/definitions/flag

  nuvoton,adcout-drive-strong:
    description: If set, makes the drive strength of ADCOUT I/O pin strong.
      Otherwise, keep the drive strength at normal level.
    $ref: /schemas/types.yaml#/definitions/flag

additionalProperties: false

required:
  - compatible
  - reg

examples:
  - |
    #include <dt-bindings/gpio/tegra-gpio.h>
    #include <dt-bindings/interrupt-controller/irq.h>
    #include <dt-bindings/soc/tegra-pmc.h>

    i2c {
      #address-cells = <1>;
      #size-cells = <0>;

      audio-codec@1a {
        compatible = "nuvoton,nau8825";
        reg = <0x1a>;
        interrupt-parent = <&gpio>;
        interrupts = <TEGRA_GPIO(E, 6) IRQ_TYPE_LEVEL_LOW>;
        nuvoton,jkdet-enable;
        nuvoton,jkdet-pull-enable;
        nuvoton,jkdet-pull-up;
        nuvoton,jkdet-polarity = <GPIO_ACTIVE_LOW>;
        nuvoton,vref-impedance = <2>;
        nuvoton,micbias-voltage = <6>;
        // Setup 4 buttons impedance according to Android specification
        nuvoton,sar-threshold-num = <4>;
        nuvoton,sar-threshold = <0xc 0x1e 0x38 0x60>;
        nuvoton,sar-hysteresis = <1>;
        nuvoton,sar-voltage = <0>;
        nuvoton,sar-compare-time = <0>;
        nuvoton,sar-sampling-time = <0>;
        nuvoton,short-key-debounce = <2>;
        nuvoton,jack-insert-debounce = <7>;
        nuvoton,jack-eject-debounce = <7>;
        nuvoton,crosstalk-enable;

        clock-names = "mclk";
        clocks = <&tegra_pmc TEGRA_PMC_CLK_OUT_2>;
      };
    };
