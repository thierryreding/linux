# SPDX-License-Identifier: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/sound/realtek,rt5640.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Realtek RT5639/RT5640 audio codec

maintainers:
  - Mark Brown <broonie@kernel.org>

description: |
  Pins on the device (for linking into audio routes) for RT5639/RT5640:

    * DMIC1
    * DMIC2
    * MICBIAS1
    * IN1P
    * IN1N
    * IN2P
    * IN2N
    * IN3P
    * IN3N
    * HPOL
    * HPOR
    * LOUTL
    * LOUTR
    * SPOLP
    * SPOLN
    * SPORP
    * SPORN

  Additional pins on the device for RT5640:

    * MONOP
    * MONON

properties:
  compatible:
    enum:
      - realtek,rt5639
      - realtek,rt5640

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks:
    items:
      - description: phandle of the master clock to the codec

  clock-names:
    items:
      - const: mclk

  realtek,in1-differential:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Indicates that the MIC1 input is differential, rather than
      single-ended.

  realtek,in2-differential:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Indicates that the MIC2 input is differential, rather than
      single-ended.

  realtek,in3-differential:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Indicates that the MIC3 input is differential, rather than
      single-ended.

  realtek,lout-differential:
    $ref: /schemas/types.yaml#/definitions/flag
    description: Indicates that the LOUT output is differential, rathen than
      stereo.

  realtek,ldo1-en-gpios:
    description: The GPIO that controls the CODEC's LDO1_EN pin.

  realtek,dmic1-data-pin:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: DMIC1 pin configuration
    oneOf:
      - description: dmic1 is not used
        const: 0
      - description: using IN1P pin as dmic1 data pin
        const: 1
      - description: using GPIO3 pin as dmic1 data pin
        const: 2

  realtek,dmic2-data-pin:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: DMIC2 pin configuration
    oneOf:
      - description: dmic2 is not used
        const: 0
      - description: using IN1N pin as dmic2 data pin
        const: 1
      - description: using GPIO4 pin as dmic2 data pin
        const: 2

  realtek,jack-detect-source:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Jack detection source configuration
    oneOf:
      - description: No JD is used
        const: 0
      - description: using GPIO1 for jack-detect
        const: 1
      - description: using JD1_IN4P for jack-detect
        const: 2
      - description: using JD2_IN4N for jack-detect
        const: 3
      - description: using GPIO2 for jack-detect
        const: 4
      - description: using GPIO3 for jack-detect
        const: 5
      - description: using GPIO4 for jack-detect
        const: 6
      - description: using HDA header for jack-detect
        const: 7

  realtek,jack-detect-not-inverted:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: Normal jack-detect switches give an inverted signal, set this
      boolean in the rare case where a jack-detect switch is not inverted.

  realtek,over-current-threshold-microamp:
    description: micbias over-current detection threshold in ÂµA
    enum: [ 600, 1500, 2000 ]

  realtek,over-current-scale-factor:
    $ref: /schemas/types.yaml#/definitions/uint32
    description: micbias over-current detection scale-factor
    oneOf:
      - description: scale current by 0.5
        const: 0
      - description: scale current by 0.75
        const: 1
      - description: scale current by 1.0
        const: 2
      - description: scale current by 1.5
        const: 3

  port:
    $ref: audio-graph-port.yaml#
    unevaluatedProperties: false

  # from component-common.yaml
  sound-name-prefix: true

allOf:
  - $ref: component-common.yaml#

additionalProperties: false

required:
  - compatible
  - reg

examples:
  - |
    #include <dt-bindings/gpio/tegra-gpio.h>
    #include <dt-bindings/interrupt-controller/irq.h>

    i2c {
        #address-cells = <1>;
        #size-cells = <0>;

        audio-codec@1c {
            compatible = "realtek,rt5640";
            reg = <0x1c>;
            interrupt-parent = <&gpio>;
            interrupts = <TEGRA_GPIO(W, 3)>;
            realtek,ldo1-en-gpios =
                    <&gpio TEGRA_GPIO(V, 3) GPIO_ACTIVE_HIGH>;
        };
    };
