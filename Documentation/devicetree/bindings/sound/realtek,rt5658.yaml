# SPDX-License-Identifier: GPL-2.0-only
%YAML 1.2
---
$id: http://devicetree.org/schemas/sound/realtek,rt5658.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: RT5658/RT5659 audio codec

maintainers:
  - Bard Liao <bardliao@realtek.com>
  - Mark Brown <broonie@kernel.org>

description: |
  This device supports I2C only.

properties:
  compatible:
    enum:
      - realtek,rt5658
      - realtek,rt5659

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks:
    items:
      - description: codec master clock

  clock-names:
    items:
      - const: mclk

  realtek,in1-differential:
    description: Indicates that the MIC1 input is differential, rather than single-ended.
    $ref: /schemas/types.yaml#/definitions/flag

  realtek,in3-differential:
    description: Indicates that the MIC3 input is differential, rather than single-ended.
    $ref: /schemas/types.yaml#/definitions/flag

  realtek,in4-differential:
    description: Indicates that the MIC4 input is differential, rather than single-ended.
    $ref: /schemas/types.yaml#/definitions/flag

  realtek,dmic1-data-pin:
    description: DMIC1 pin configuration
    $ref: /schemas/types.yaml#/definitions/uint32
    oneOf:
      - description: dmic1 is not used
        const: 0
      - description: using IN2N pin as dmic1 data pin
        const: 1
      - description: using GPIO5 pin as dmic1 data pin
        const: 2
      - description: using GPIO9 pin as dmic1 data pin
        const: 3
      - description: using GPIO11 pin as dmic1 data pin
        const: 4

  realtek,dmic2-data-pin:
    description: DMIC2 pin configuration
    $ref: /schemas/types.yaml#/definitions/uint32
    oneOf:
      - description: dmic2 is not used
        const: 0
      - description: using IN2P pin as dmic2 data pin
        const: 1
      - description: using GPIO6 pin as dmic2 data pin
        const: 2
      - description: using GPIO10 pin as dmic2 data pin
        const: 3
      - description: using GPIO12 pin as dmic2 data pin
        const: 4

  realtek,jd-src:
    description: JD source configuration
    $ref: /schemas/types.yaml#/definitions/uint32
    oneOf:
      - description: No JD is used
        const: 0
      - description: using JD3 as JD source
        const: 1
      - description: JD source for Intel HDA header
        const: 2

  realtek,ldo1-en-gpios:
    description: The GPIO that controls the CODEC's LDO1_EN pin.

  realtek,reset-gpios:
    description: The GPIO that controls the CODEC's RESET pin.

  port:
    description: |
      A codec may have a single or multiple I2S interfaces. These interfaces on codec side can be
      described under 'ports' or 'port'. When the SoC or host device is connected to multiple
      interfaces of the codec, the connectivity can be described using 'ports' property. If a
      single interface is used, then 'port' can be used. The usage depends on the platform or
      board design. Please refer to Documentation/devicetree/bindings/graph.txt.

      Pins on the device (for linking into audio routes) for RT5658/RT5659:

        * DMIC L1
        * DMIC R1
        * DMIC L2
        * DMIC R2
        * IN1P
        * IN1N
        * IN2P
        * IN2N
        * IN3P
        * IN3N
        * IN4P
        * IN4N
        * HPOL
        * HPOR
        * SPOL
        * SPOR
        * LOUTL
        * LOUTR
        * MONOOUT
        * PDML
        * PDMR
        * SPDIF
    type: object

  # from name-prefix.yaml
  sound-name-prefix:
    description: Please refer to name-prefix.yaml

allOf:
  - $ref: name-prefix.yaml

additionalProperties: false

required:
  - compatible
  - reg
  - interrupts

examples:
  - |
    #include <dt-bindings/clock/tegra194-clock.h>
    #include <dt-bindings/gpio/tegra194-gpio.h>
    #include <dt-bindings/interrupt-controller/arm-gic.h>
    #include <dt-bindings/reset/tegra194-reset.h>

    i2c@c250000 {
      compatible = "nvidia,tegra194-i2c";
      reg = <0x0c250000 0x10000>;
      interrupts = <GIC_SPI 32 IRQ_TYPE_LEVEL_HIGH>;
      clocks = <&bpmp TEGRA194_CLK_I2C8>;
      clock-names = "div-clk";
      resets = <&bpmp TEGRA194_RESET_I2C8>;
      reset-names = "i2c";

      #address-cells = <1>;
      #size-cells = <0>;

      audio-codec@1a {
        compatible = "realtek,rt5658";
        reg = <0x1a>;
        interrupt-parent = <&gpio>;
        interrupts = <TEGRA194_MAIN_GPIO(S, 5) GPIO_ACTIVE_HIGH>;
        clocks = <&bpmp TEGRA194_CLK_AUD_MCLK>;
        clock-names = "mclk";
        realtek,jd-src = <2>;
        sound-name-prefix = "CVB-RT";

        port {
          endpoint {
            remote-endpoint = <&i2s1_dap_ep>;
            mclk-fs = <256>;
          };
        };
      };
    };
