# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/spi/nvidia,tegra114-spi.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: NVIDIA Tegra114 SPI controller

maintainers:
  - Thierry Reding <thierry.reding@gmail.com>
  - Jon Hunter <jonathanh@nvidia.com>

allOf:
  - $ref: "spi-controller.yaml"

properties:
  compatible:
    oneOf:
      - const: nvidia,tegra114-spi

      - items:
          - enum:
              - nvidia,tegra210-spi
              - nvidia,tegra124-spi
          - const: nvidia,tegra114-spi

  reg:
    maxItems: 1

  interrupts:
    maxItems: 1

  clocks:
    items:
      - description: SPI module clock

  clock-names:
    items:
      - const: spi

  resets:
    items:
      - description: SPI module reset

  reset-names:
    items:
      - const: spi

  dmas:
    items:
      - description: DMA channel for the reception FIFO
      - description: DMA channel for the transmission FIFO

  dma-names:
    items:
      - const: rx
      - const: tx

  spi-max-frequency:
    description: Maximum SPI clocking speed of the controller in Hz.
    $ref: /schemas/types.yaml#/definitions/uint32

  '#address-cells': true
  '#size-cells': true

patternProperties:
  "^.*@[0-9a-f]+$":
    type: object
    properties:
      nvidia,tx-clk-tap-delay:
        description: Delays the clock going out to the external device with
          this tap value. This property is used to tune the outgoing data from
          Tegra SPI master with respect to outgoing Tegra SPI master clock.
          Tap values vary based on the platform design trace lengths from
          Tegra SPI to corresponding slave devices.
        $ref: /schemas/types.yaml#/definitions/uint32
        minimum: 0
        maximum: 63

      nvidia,rx-clk-tap-delay:
        description: Delays the clock coming in from the external device with
          this tap value. This property is used to adjust the Tegra SPI master
          clock with respect to the data from the SPI slave device. Tap values
          vary based on the platform design trace lengths from Tegra SPI to
          corresponding slave devices.
        $ref: /schemas/types.yaml#/definitions/uint32
        minimum: 0
        maximum: 63

required:
  - compatible
  - reg
  - interrupts
  - clocks
  - clock-names
  - resets
  - reset-names
  - dmas
  - dma-names

additionalProperties: false

examples:
  - |
    spi@7000d600 {
        compatible = "nvidia,tegra114-spi";
        reg = <0x7000d600 0x200>;
        interrupts = <0 82 0x04>;
        clocks = <&tegra_car 44>;
        clock-names = "spi";
        resets = <&tegra_car 44>;
        reset-names = "spi";
        dmas = <&apbdma 16>, <&apbdma 16>;
        dma-names = "rx", "tx";

        spi-max-frequency = <25000000>;

        #address-cells = <1>;
        #size-cells = <0>;

        flash@0 {
            compatible = "spi-nor";
            reg = <0>;
            spi-max-frequency = <20000000>;
            nvidia,rx-clk-tap-delay = <0>;
            nvidia,tx-clk-tap-delay = <16>;
        };
    };
